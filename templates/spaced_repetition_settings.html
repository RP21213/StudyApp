<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaced Repetition Settings - StudyBot</title>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .settings-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .settings-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .settings-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .settings-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .settings-content {
            padding: 40px;
        }

        .settings-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-description {
            color: #666;
            margin-bottom: 25px;
            font-size: 1rem;
            line-height: 1.5;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }

        .setting-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .setting-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .setting-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .setting-icon {
            width: 24px;
            height: 24px;
            color: #667eea;
        }

        .setting-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .setting-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .setting-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .setting-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .setting-range {
            width: 100%;
            margin: 10px 0;
        }

        .range-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .range-value {
            background: #667eea;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            min-width: 60px;
            text-align: center;
        }

        .preset-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .preset-btn:hover {
            background: #667eea;
            color: white;
        }

        .preset-btn.active {
            background: #667eea;
            color: white;
        }

        .settings-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 150px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            font-weight: 500;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info-box {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-box p {
            color: #1565c0;
            line-height: 1.5;
        }

        .quick-presets {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .quick-presets h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .preset-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .preset-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .preset-card.active {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .preset-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .preset-description {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.3;
        }

        @media (max-width: 768px) {
            .settings-content {
                padding: 20px;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .settings-actions {
                flex-direction: column;
            }

            .preset-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="settings-container">
        <div class="settings-header">
            <h1>üß† Spaced Repetition Settings</h1>
            <p>Customize your learning experience for optimal retention</p>
        </div>

        <div class="settings-content">
            <div id="status-message" class="status-message"></div>

            <!-- Quick Presets -->
            <div class="quick-presets">
                <h3>
                    <i data-lucide="zap"></i>
                    Quick Presets
                </h3>
                <div class="preset-grid">
                    <div class="preset-card" onclick="applyPreset('beginner')">
                        <div class="preset-name">üå± Beginner</div>
                        <div class="preset-description">Gentle learning pace<br>10 new cards/day<br>100 reviews/day</div>
                    </div>
                    <div class="preset-card active" onclick="applyPreset('balanced')">
                        <div class="preset-name">‚öñÔ∏è Balanced</div>
                        <div class="preset-description">Recommended settings<br>20 new cards/day<br>200 reviews/day</div>
                    </div>
                    <div class="preset-card" onclick="applyPreset('intensive')">
                        <div class="preset-name">üöÄ Intensive</div>
                        <div class="preset-description">Fast learning pace<br>50 new cards/day<br>500 reviews/day</div>
                    </div>
                </div>
            </div>

            <!-- Basic Settings -->
            <div class="settings-section">
                <h2 class="section-title">
                    <i data-lucide="settings"></i>
                    Daily Limits
                </h2>
                <div class="section-description">
                    Control how many cards you study each day. Start with lower numbers and increase as you get comfortable.
                </div>
                
                <div class="settings-grid">
                    <div class="setting-card">
                        <div class="setting-header">
                            <i data-lucide="plus-circle" class="setting-icon"></i>
                            <div class="setting-title">New Cards Per Day</div>
                        </div>
                        <div class="setting-description">
                            Maximum number of new cards to introduce each day. More cards = faster learning but more reviews later.
                        </div>
                        <input type="number" id="new-cards-per-day" class="setting-input" min="1" max="100" value="20">
                        <div class="preset-buttons">
                            <button class="preset-btn" onclick="setPreset('new-cards-per-day', 10)">10</button>
                            <button class="preset-btn active" onclick="setPreset('new-cards-per-day', 20)">20</button>
                            <button class="preset-btn" onclick="setPreset('new-cards-per-day', 30)">30</button>
                            <button class="preset-btn" onclick="setPreset('new-cards-per-day', 50)">50</button>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <i data-lucide="refresh-cw" class="setting-icon"></i>
                            <div class="setting-title">Max Reviews Per Day</div>
                        </div>
                        <div class="setting-description">
                            Maximum number of cards to review in a single day. This prevents overwhelming study sessions.
                        </div>
                        <input type="number" id="max-reviews-per-day" class="setting-input" min="10" max="1000" value="200">
                        <div class="preset-buttons">
                            <button class="preset-btn" onclick="setPreset('max-reviews-per-day', 100)">100</button>
                            <button class="preset-btn active" onclick="setPreset('max-reviews-per-day', 200)">200</button>
                            <button class="preset-btn" onclick="setPreset('max-reviews-per-day', 300)">300</button>
                            <button class="preset-btn" onclick="setPreset('max-reviews-per-day', 500)">500</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Algorithm Settings -->
            <div class="settings-section">
                <h2 class="section-title">
                    <i data-lucide="brain"></i>
                    Algorithm Settings
                </h2>
                <div class="section-description">
                    Fine-tune how the spaced repetition algorithm works. These settings affect how quickly you see cards again.
                </div>
                
                <div class="settings-grid">
                    <div class="setting-card">
                        <div class="setting-header">
                            <i data-lucide="trending-up" class="setting-icon"></i>
                            <div class="setting-title">Easy Bonus</div>
                        </div>
                        <div class="setting-description">
                            When you rate a card "Easy", how much longer should the next interval be? Higher values = longer intervals.
                        </div>
                        <div class="range-container">
                            <input type="range" id="easy-bonus" class="setting-range" min="1.0" max="2.0" step="0.1" value="1.3">
                            <div class="range-value" id="easy-bonus-value">1.3</div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <i data-lucide="sliders" class="setting-icon"></i>
                            <div class="setting-title">Interval Modifier</div>
                        </div>
                        <div class="setting-description">
                            Global multiplier for all intervals. 1.0 = normal speed, 0.5 = faster, 2.0 = slower.
                        </div>
                        <div class="range-container">
                            <input type="range" id="interval-modifier" class="setting-range" min="0.5" max="2.0" step="0.1" value="1.0">
                            <div class="range-value" id="interval-modifier-value">1.0</div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <i data-lucide="calendar" class="setting-icon"></i>
                            <div class="setting-title">Max Interval (Days)</div>
                        </div>
                        <div class="setting-description">
                            Maximum time between reviews. Cards won't have intervals longer than this.
                        </div>
                        <input type="number" id="max-interval" class="setting-input" min="30" max="36500" value="36500">
                        <div class="preset-buttons">
                            <button class="preset-btn" onclick="setPreset('max-interval', 365)">1 Year</button>
                            <button class="preset-btn" onclick="setPreset('max-interval', 1825)">5 Years</button>
                            <button class="preset-btn active" onclick="setPreset('max-interval', 36500)">100 Years</button>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <i data-lucide="clock" class="setting-icon"></i>
                            <div class="setting-title">Min Interval (Days)</div>
                        </div>
                        <div class="setting-description">
                            Minimum time between reviews. Cards won't have intervals shorter than this.
                        </div>
                        <input type="number" id="min-interval" class="setting-input" min="1" max="30" value="1">
                        <div class="preset-buttons">
                            <button class="preset-btn active" onclick="setPreset('min-interval', 1)">1 Day</button>
                            <button class="preset-btn" onclick="setPreset('min-interval', 2)">2 Days</button>
                            <button class="preset-btn" onclick="setPreset('min-interval', 7)">1 Week</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Learning Steps -->
            <div class="settings-section">
                <h2 class="section-title">
                    <i data-lucide="graduation-cap"></i>
                    Learning Steps
                </h2>
                <div class="section-description">
                    Control how new cards are introduced. These are the intervals (in minutes) before a card graduates to normal review.
                </div>
                
                <div class="settings-grid">
                    <div class="setting-card">
                        <div class="setting-header">
                            <i data-lucide="book-open" class="setting-icon"></i>
                            <div class="setting-title">Learning Steps</div>
                        </div>
                        <div class="setting-description">
                            Intervals for new cards (space-separated minutes). Example: "1 10" means 1 minute, then 10 minutes.
                        </div>
                        <input type="text" id="learning-steps" class="setting-input" value="1 10">
                        <div class="preset-buttons">
                            <button class="preset-btn active" onclick="setPreset('learning-steps', '1 10')">Default</button>
                            <button class="preset-btn" onclick="setPreset('learning-steps', '1 5 15')">Fast</button>
                            <button class="preset-btn" onclick="setPreset('learning-steps', '1 10 30')">Slow</button>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <i data-lucide="alert-triangle" class="setting-icon"></i>
                            <div class="setting-title">Lapse Steps</div>
                        </div>
                        <div class="setting-description">
                            When you forget a card, these are the intervals (in minutes) before it goes back to normal review.
                        </div>
                        <input type="text" id="lapse-steps" class="setting-input" value="10">
                        <div class="preset-buttons">
                            <button class="preset-btn active" onclick="setPreset('lapse-steps', '10')">Default</button>
                            <button class="preset-btn" onclick="setPreset('lapse-steps', '5 15')">Fast</button>
                            <button class="preset-btn" onclick="setPreset('lapse-steps', '15 30')">Slow</button>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <i data-lucide="percent" class="setting-icon"></i>
                            <div class="setting-title">Lapse Interval</div>
                        </div>
                        <div class="setting-description">
                            When you forget a card, multiply its interval by this value. Lower = more frequent reviews.
                        </div>
                        <div class="range-container">
                            <input type="range" id="lapse-interval" class="setting-range" min="0.1" max="1.0" step="0.1" value="0.1">
                            <div class="range-value" id="lapse-interval-value">0.1</div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <i data-lucide="award" class="setting-icon"></i>
                            <div class="setting-title">Graduated Interval</div>
                        </div>
                        <div class="setting-description">
                            After completing learning steps, what should the first normal review interval be?
                        </div>
                        <input type="number" id="graduated-interval" class="setting-input" min="1" max="30" value="1">
                        <div class="preset-buttons">
                            <button class="preset-btn active" onclick="setPreset('graduated-interval', 1)">1 Day</button>
                            <button class="preset-btn" onclick="setPreset('graduated-interval', 2)">2 Days</button>
                            <button class="preset-btn" onclick="setPreset('graduated-interval', 7)">1 Week</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>
                    <i data-lucide="info"></i>
                    How Spaced Repetition Works
                </h3>
                <p>
                    Spaced repetition helps you remember information long-term by showing you cards at increasing intervals. 
                    When you rate a card "Good" or "Easy", the next interval gets longer. When you rate it "Hard" or "Again", 
                    the interval gets shorter. This ensures you review difficult cards more often and easy cards less often.
                </p>
            </div>

            <!-- Actions -->
            <div class="settings-actions">
                <button class="btn btn-primary" onclick="saveSettings()">
                    <i data-lucide="save"></i>
                    Save Settings
                </button>
                <button class="btn btn-secondary" onclick="resetToDefaults()">
                    <i data-lucide="rotate-ccw"></i>
                    Reset to Defaults
                </button>
                <button class="btn btn-success" onclick="testSettings()">
                    <i data-lucide="check-circle"></i>
                    Test Settings
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Preset configurations
        const presets = {
            beginner: {
                new_cards_per_day: 10,
                max_reviews_per_day: 100,
                easy_bonus: 1.2,
                interval_modifier: 0.8,
                max_interval: 365,
                min_interval: 1,
                learning_steps: '1 10',
                lapse_steps: '10',
                lapse_interval: 0.2,
                graduated_interval: 1
            },
            balanced: {
                new_cards_per_day: 20,
                max_reviews_per_day: 200,
                easy_bonus: 1.3,
                interval_modifier: 1.0,
                max_interval: 36500,
                min_interval: 1,
                learning_steps: '1 10',
                lapse_steps: '10',
                lapse_interval: 0.1,
                graduated_interval: 1
            },
            intensive: {
                new_cards_per_day: 50,
                max_reviews_per_day: 500,
                easy_bonus: 1.5,
                interval_modifier: 1.2,
                max_interval: 36500,
                min_interval: 1,
                learning_steps: '1 5 15',
                lapse_steps: '5 15',
                lapse_interval: 0.1,
                graduated_interval: 1
            }
        };

        // Load current settings
        async function loadSettings() {
            try {
                const response = await fetch('/api/spaced_repetition/user_settings');
                const data = await response.json();
                
                if (data.success && data.settings) {
                    const settings = data.settings;
                    
                    // Populate form fields
                    document.getElementById('new-cards-per-day').value = settings.new_cards_per_day || 20;
                    document.getElementById('max-reviews-per-day').value = settings.max_reviews_per_day || 200;
                    document.getElementById('easy-bonus').value = settings.easy_bonus || 1.3;
                    document.getElementById('interval-modifier').value = settings.interval_modifier || 1.0;
                    document.getElementById('max-interval').value = settings.max_interval || 36500;
                    document.getElementById('min-interval').value = settings.min_interval || 1;
                    document.getElementById('learning-steps').value = settings.learning_steps || '1 10';
                    document.getElementById('lapse-steps').value = settings.lapse_steps || '10';
                    document.getElementById('lapse-interval').value = settings.lapse_interval || 0.1;
                    document.getElementById('graduated-interval').value = settings.graduated_interval || 1;
                    
                    // Update range values
                    updateRangeValues();
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                showStatus('Error loading settings', 'error');
            }
        }

        // Apply preset configuration
        function applyPreset(presetName) {
            const preset = presets[presetName];
            if (!preset) return;

            // Update all form fields
            Object.keys(preset).forEach(key => {
                const element = document.getElementById(key.replace(/_/g, '-'));
                if (element) {
                    element.value = preset[key];
                }
            });

            // Update range values
            updateRangeValues();

            // Update active preset card
            document.querySelectorAll('.preset-card').forEach(card => card.classList.remove('active'));
            event.target.closest('.preset-card').classList.add('active');

            showStatus(`Applied ${presetName} preset`, 'success');
        }

        // Update range value displays
        function updateRangeValues() {
            document.getElementById('easy-bonus-value').textContent = document.getElementById('easy-bonus').value;
            document.getElementById('interval-modifier-value').textContent = document.getElementById('interval-modifier').value;
            document.getElementById('lapse-interval-value').textContent = document.getElementById('lapse-interval').value;
        }

        // Set preset values
        function setPreset(fieldId, value) {
            document.getElementById(fieldId).value = value;
            
            // Update active preset button
            const group = document.getElementById(fieldId).closest('.setting-card');
            group.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Save settings
        async function saveSettings() {
            try {
                const settings = {
                    new_cards_per_day: parseInt(document.getElementById('new-cards-per-day').value),
                    max_reviews_per_day: parseInt(document.getElementById('max-reviews-per-day').value),
                    easy_bonus: parseFloat(document.getElementById('easy-bonus').value),
                    interval_modifier: parseFloat(document.getElementById('interval-modifier').value),
                    max_interval: parseInt(document.getElementById('max-interval').value),
                    min_interval: parseInt(document.getElementById('min-interval').value),
                    learning_steps: document.getElementById('learning-steps').value,
                    lapse_steps: document.getElementById('lapse-steps').value,
                    lapse_interval: parseFloat(document.getElementById('lapse-interval').value),
                    graduated_interval: parseInt(document.getElementById('graduated-interval').value)
                };

                const response = await fetch('/api/spaced_repetition/user_settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(settings)
                });

                const data = await response.json();
                
                if (data.success) {
                    showStatus('‚úÖ Settings saved successfully!', 'success');
                } else {
                    showStatus('‚ùå Error saving settings: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                showStatus('‚ùå Error saving settings', 'error');
            }
        }

        // Reset to defaults
        function resetToDefaults() {
            if (confirm('Are you sure you want to reset all settings to defaults?')) {
                applyPreset('balanced');
                showStatus('‚úÖ Settings reset to defaults', 'success');
            }
        }

        // Test settings
        async function testSettings() {
            try {
                showStatus('üîÑ Testing settings...', 'success');
                
                const response = await fetch('/api/spaced_repetition/system_health');
                const data = await response.json();
                
                if (data.success) {
                    showStatus('‚úÖ Settings test passed! System is operational.', 'success');
                } else {
                    showStatus('‚ùå Settings test failed: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error testing settings:', error);
                showStatus('‚ùå Error testing settings', 'error');
            }
        }

        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message status-${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Event listeners for range inputs
        document.getElementById('easy-bonus').addEventListener('input', updateRangeValues);
        document.getElementById('interval-modifier').addEventListener('input', updateRangeValues);
        document.getElementById('lapse-interval').addEventListener('input', updateRangeValues);

        // Load settings on page load
        document.addEventListener('DOMContentLoaded', loadSettings);
    </script>
</body>
</html>